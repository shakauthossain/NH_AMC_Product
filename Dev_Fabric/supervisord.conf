[supervisord]
nodaemon=true
logfile=/dev/stdout
pidfile=/tmp/supervisord.pid

[program:redis]
command=/usr/bin/redis-server --save "" --appendonly no
autorestart=true
priority=5
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

; Celery worker (solo pool; fine for Spaces)
[program:celery]
directory=/app/Dev_Fabric
command=/usr/local/bin/celery -A celery_app worker -l info --pool=solo
environment=PYTHONPATH="/app/Dev_Fabric"
autorestart=true
priority=10
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

; FastAPI app with uvicorn
[program:api]
directory=/app/Dev_Fabric
command=/usr/local/bin/uvicorn main:app --host 0.0.0.0 --port %(ENV_PORT)s --workers 1
environment=PYTHONPATH="/app/Dev_Fabric"
autorestart=true
priority=20
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
